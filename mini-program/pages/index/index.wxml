<view class="container">
  <!-- 今日概览卡片 -->
  <view class="card today-overview">
    <view class="overview-header">
      <text class="text-medium text-bold">今日概览</text>
      <text class="text-small text-muted">{{today}}</text>
    </view>
    
    <!-- 宝宝选择器 -->
    <view class="baby-selector" wx:if="{{babies && babies.length > 0}}">
      <!-- 单个宝宝时显示宝宝信息 -->
      <view class="single-baby-info" wx:if="{{babies.length === 1}}">
        <image class="baby-avatar" src="{{selectedBaby.avatar}}" mode="aspectFill"></image>
        <view class="baby-details">
          <text class="baby-name">{{selectedBaby.name}}</text>
          <text class="baby-age">{{selectedBaby.age}}</text>
        </view>
      </view>
      
      <!-- 多个宝宝时显示选择器 -->
      <view class="multi-baby-selector" wx:else>
        <view class="selector-header">
          <text class="form-label">👶 查看宝宝数据：</text>
        </view>
        <view class="baby-tabs">
          <view class="baby-tab {{selectedBabyIndex === index ? 'active' : ''}}" 
                wx:for="{{babies}}" 
                wx:key="id" 
                wx:for-index="index"
                bindtap="onBabyChange" 
                data-index="{{index}}">
            <image class="tab-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <view class="tab-content">
              <text class="tab-name">{{item.name}}</text>
              <text class="tab-age">{{item.age}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view class="overview-stats">
      <view class="stat-item">
        <view class="stat-value primary-color">{{todayStats.feedingTotal}}ml</view>
        <view class="stat-label">喂养总量</view>
      </view>
      <view class="stat-item">
        <view class="stat-value secondary-color">{{todayStats.feedingCount}}次</view>
        <view class="stat-label">喂养次数</view>
      </view>
      <view class="stat-item">
        <view class="stat-value warning-color">{{todayStats.diaperCount}}次</view>
        <view class="stat-label">大便次数</view>
      </view>
    </view>

    <!-- 智能建议 -->
    <view class="suggestion" wx:if="{{suggestion}}">
      <view class="suggestion-icon">💡</view>
      <text class="suggestion-text">{{suggestion}}</text>
    </view>
  </view>

  <!-- 快捷记录按钮 -->
  <view class="card quick-record">
    <view class="quick-record-header">
      <text class="text-medium text-bold">快速记录</text>
    </view>
    
    <view class="record-buttons">
      <view class="record-btn" bindtap="showRecordModal" data-type="breastfeeding">
        <view class="btn-icon">🤱</view>
        <text class="btn-text">母乳亲喂</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="bottle">
        <view class="btn-icon">🍼</view>
        <text class="btn-text">瓶喂</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="formula">
        <view class="btn-icon">🥛</view>
        <text class="btn-text">奶粉</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="solid">
        <view class="btn-icon">🥣</view>
        <text class="btn-text">辅食</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="water">
        <view class="btn-icon">💧</view>
        <text class="btn-text">喂水</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="diaper">
        <view class="btn-icon">💩</view>
        <text class="btn-text">大便</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="growth">
        <view class="btn-icon">📏</view>
        <text class="btn-text">成长</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="nutrition">
        <view class="btn-icon">💊</view>
        <text class="btn-text">营养素</text>
      </view>
    </view>
  </view>

  <!-- 今日最近记录 -->
  <view class="card recent-records">
    <view class="recent-header">
      <text class="text-medium text-bold">今日最近记录</text>
      <text class="text-small text-primary" bindtap="goToRecords">查看全部</text>
    </view>
    
    <view class="records-list" wx:if="{{recentRecords.length > 0}}">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id">
        <view class="record-icon">
          <text>{{item.icon}}</text>
        </view>
        <view class="record-content">
          <view class="record-title">{{item.title}}</view>
          <view class="record-detail">{{item.detail}}</view>
        </view>
        <view class="record-time">{{item.time}}</view>
      </view>
    </view>
    
    <view class="empty" wx:else>
      <view class="empty-icon">📝</view>
      <text class="text-muted">还没有记录，开始记录宝宝的成长吧</text>
    </view>
  </view>
</view>

<!-- 记录弹窗 -->
<view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="text-medium text-bold">{{modalTitle}}</text>
      <view class="modal-header-actions">
        <view class="voice-btn" bindtap="showVoiceInput">🎤</view>
        <view class="modal-close" bindtap="hideModal">×</view>
      </view>
    </view>
    
    <!-- 语音输入组件 -->
    <voice-input 
      show="{{showVoiceInputModal}}"
      record-type="{{recordType}}"
      bind:parsed="onVoiceParsed"
      bind:confirm="onVoiceConfirmed"
      bind:cancel="onVoiceCanceled"
      bind:close="hideVoiceInput">
    </voice-input>
    
    <view class="modal-body">
      <!-- 母乳亲喂 -->
      <view wx:if="{{recordType === 'breastfeeding'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂养时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">时长（分钟）</text>
          <input type="number" placeholder="请输入时长" value="{{recordData.duration}}" bindinput="onDurationChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">选择乳房</text>
          <view class="breast-selector">
            <view class="breast-option {{recordData.breast === 'left' ? 'active' : ''}}" bindtap="selectBreast" data-breast="left">
              左侧
            </view>
            <view class="breast-option {{recordData.breast === 'right' ? 'active' : ''}}" bindtap="selectBreast" data-breast="right">
              右侧
            </view>
          </view>
        </view>
      </view>
      
      <!-- 瓶喂 -->
      <view wx:if="{{recordType === 'bottle'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂养时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂奶量（ml）</text>
          <input type="number" placeholder="请输入喂奶量" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- 配方奶 -->
      <view wx:if="{{recordType === 'formula'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂养时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂奶量（ml）</text>
          <input type="number" placeholder="请输入喂奶量" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- 喂水 -->
      <view wx:if="{{recordType === 'water'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂水时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">喂水量（ml）</text>
          <input type="number" placeholder="请输入喂水量" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- 辅食 -->
      <view wx:if="{{recordType === 'solid'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">辅食类型</text>
          <!-- 修改为类似乳房选择的按钮形式，支持多选 -->
          <view class="solid-type-selector">
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[0] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{0}}">
              米糊
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[1] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{1}}">
              蔬菜泥
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[2] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{2}}">
              水果泥
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[3] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{3}}">
              肉泥
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[4] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{4}}">
              蛋黄
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[5] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{5}}">
              其他
            </view>
          </view>
        </view>
        
        <!-- 新增：多种食材输入 -->
        <view class="form-item">
          <text class="form-label">食材（多种，用逗号分隔）</text>
          <input type="text" placeholder="例如：米粉,胡萝卜泥,苹果泥" value="{{recordData.solidIngredients}}" bindinput="onSolidIngredientsChange" />
        </view>
        
        <!-- 新增：品牌输入 -->
        <view class="form-item">
          <text class="form-label">品牌（可选）</text>
          <input type="text" placeholder="请输入品牌" value="{{recordData.solidBrand}}" bindinput="onSolidBrandChange" />
        </view>
        
        <!-- 新增：产地输入 -->
        <view class="form-item">
          <text class="form-label">产地（可选）</text>
          <input type="text" placeholder="请输入产地" value="{{recordData.solidOrigin}}" bindinput="onSolidOriginChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">喂食量(米粉几勺)</text>
          <input type="number" placeholder="请输入喂食量" value="{{recordData.solidAmount}}" bindinput="onSolidAmountChange" />
        </view>
      </view>
      
      <!-- 大便 -->
      <view wx:if="{{recordType === 'diaper'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">性状</text>
          <picker range="{{diaperTextures}}" value="{{recordData.textureIndex}}" bindchange="onTextureChange">
            <view class="picker">{{diaperTextures[recordData.textureIndex] || '请选择性状'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">颜色</text>
          <picker range="{{diaperColors}}" value="{{recordData.colorIndex}}" bindchange="onColorChange">
            <view class="picker">{{diaperColors[recordData.colorIndex] || '请选择颜色'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">备注</text>
          <input type="text" placeholder="请输入备注" value="{{recordData.note}}" bindinput="onNoteChange" />
        </view>
      </view>
      
      <!-- 成长 -->
      <view wx:if="{{recordType === 'growth'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">身高（cm）</text>
          <input type="digit" placeholder="请输入身高" value="{{recordData.height}}" bindinput="onHeightChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">体重（kg）</text>
          <input type="digit" placeholder="请输入体重" value="{{recordData.weight}}" bindinput="onWeightChange" />
        </view>
      </view>
      
      <!-- 营养素 -->
      <view wx:if="{{recordType === 'nutrition'}}">
        <!-- 昨天营养素记录 -->
        <view class="yesterday-nutrition-section" wx:if="{{yesterdayNutritionRecords && yesterdayNutritionRecords.length > 0}}">
          <text class="yesterday-label">昨天营养素摄入情况</text>
          <view class="yesterday-nutrition-list">
            <view class="yesterday-nutrition-item" wx:for="{{yesterdayNutritionRecords}}" wx:key="id">
              <view class="nutrition-detail-item">
                <text class="nutrition-icon-small">💊</text>
                <view class="nutrition-types-wrapper">
                  <text class="nutrition-type-tag" wx:for="{{item.types}}" wx:for-item="type" wx:key="*this">
                    {{type}}
                  </text>
                </view>
                <text class="nutrition-detail-time">{{item.time}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || '请选择日期'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">时间</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || '请选择时间'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">营养素类型</text>
          <!-- 使用类似辅食的多选按钮 -->
          <view class="nutrition-type-selector">
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[0] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{0}}">
              AD
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[1] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{1}}">
              D3
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[2] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{2}}">
              钙
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[3] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{3}}">
              DHA
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[4] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{4}}">
              锌
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[5] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{5}}">
              铁
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[6] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{6}}">
              益生菌
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[7] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{7}}">
              其他
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn btn-outline" bindtap="hideModal">取消</button>
      <button class="btn btn-primary" bindtap="saveRecord">保存</button>
    </view>
  </view>
</view>
