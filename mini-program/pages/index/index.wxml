<view class="container">
  <!-- æœªç™»å½•æˆæƒæç¤º -->
  <view wx:if="{{!userInfo || !userInfo.nickName}}" style="margin: 20rpx 0;">
    <button type="primary" bindtap="onTapLogin">æˆæƒç™»å½•</button>
  </view>
  <!-- é¡¶éƒ¨æ¬¢è¿åŒºåŸŸ -->
  <view class="welcome-section">
    <view class="welcome-text">
      <text class="text-large text-bold">æ¬¢è¿å›æ¥</text>
      <text class="text-medium text-muted mt-10">{{userInfo.nickName}}</text>
    </view>
    <view class="baby-avatar">
      <image src="{{babyInfo.avatar || '/images/baby-default.png'}}" class="avatar"></image>
    </view>
  </view>

  <!-- ä»Šæ—¥æ¦‚è§ˆå¡ç‰‡ -->
  <view class="card today-overview">
    <view class="overview-header">
      <text class="text-medium text-bold">ä»Šæ—¥æ¦‚è§ˆ</text>
      <text class="text-small text-muted">{{today}}</text>
    </view>
    
    <!-- å®å®å¹´é¾„ä¿¡æ¯ -->
    <view class="baby-age-info" wx:if="{{babyInfo && babyInfo.name}}">
      <text class="baby-name">{{babyInfo.name}}</text>
      <text class="baby-age">{{babyInfo.age}}</text>
    </view>
    
    <view class="overview-stats">
      <view class="stat-item">
        <view class="stat-value primary-color">{{todayStats.feedingTotal}}ml</view>
        <view class="stat-label">å–‚å…»æ€»é‡</view>
      </view>
      <view class="stat-item">
        <view class="stat-value secondary-color">{{todayStats.feedingCount}}æ¬¡</view>
        <view class="stat-label">å–‚å…»æ¬¡æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value warning-color">{{todayStats.diaperCount}}æ¬¡</view>
        <view class="stat-label">å¤§ä¾¿æ¬¡æ•°</view>
      </view>
    </view>

    <!-- æ™ºèƒ½å»ºè®® -->
    <view class="suggestion" wx:if="{{suggestion}}">
      <view class="suggestion-icon">ğŸ’¡</view>
      <text class="suggestion-text">{{suggestion}}</text>
    </view>
  </view>

  <!-- å¿«æ·è®°å½•æŒ‰é’® -->
  <view class="card quick-record">
    <view class="quick-record-header">
      <text class="text-medium text-bold">å¿«é€Ÿè®°å½•</text>
    </view>
    
    <view class="record-buttons">
      <view class="record-btn" bindtap="showRecordModal" data-type="breastfeeding">
        <view class="btn-icon">ğŸ¤±</view>
        <text class="btn-text">æ¯ä¹³äº²å–‚</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="bottle">
        <view class="btn-icon">ğŸ¼</view>
        <text class="btn-text">ç“¶å–‚</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="formula">
        <view class="btn-icon">ğŸ¥›</view>
        <text class="btn-text">é…æ–¹å¥¶</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="solid">
        <view class="btn-icon">ğŸ¥£</view>
        <text class="btn-text">è¾…é£Ÿ</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="diaper">
        <view class="btn-icon">ğŸ’©</view>
        <text class="btn-text">å¤§ä¾¿</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="growth">
        <view class="btn-icon">ğŸ“</view>
        <text class="btn-text">æˆé•¿</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="card recent-records">
    <view class="recent-header">
      <text class="text-medium text-bold">æœ€è¿‘è®°å½•</text>
      <text class="text-small text-primary" bindtap="goToRecords">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="records-list" wx:if="{{recentRecords.length > 0}}">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id">
        <view class="record-icon">
          <text>{{item.icon}}</text>
        </view>
        <view class="record-content">
          <view class="record-title">{{item.title}}</view>
          <view class="record-detail">{{item.detail}}</view>
        </view>
        <view class="record-time">{{item.time}}</view>
      </view>
    </view>
    
    <view class="empty" wx:else>
      <view class="empty-icon">ğŸ“</view>
      <text class="text-muted">è¿˜æ²¡æœ‰è®°å½•ï¼Œå¼€å§‹è®°å½•å®å®çš„æˆé•¿å§</text>
    </view>
  </view>
</view>

<!-- è®°å½•å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="text-medium text-bold">{{modalTitle}}</text>
      <view class="modal-close" bindtap="hideModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <!-- æ¯ä¹³äº²å–‚ -->
      <view wx:if="{{recordType === 'breastfeeding'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥æ—¶é•¿" value="{{recordData.duration}}" bindinput="onDurationChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">é€‰æ‹©ä¹³æˆ¿</text>
          <view class="breast-selector">
            <view class="breast-option {{recordData.breast === 'left' ? 'active' : ''}}" bindtap="selectBreast" data-breast="left">
              å·¦ä¾§
            </view>
            <view class="breast-option {{recordData.breast === 'right' ? 'active' : ''}}" bindtap="selectBreast" data-breast="right">
              å³ä¾§
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç“¶å–‚ -->
      <view wx:if="{{recordType === 'bottle'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å¥¶é‡ï¼ˆmlï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥å–‚å¥¶é‡" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- é…æ–¹å¥¶ -->
      <view wx:if="{{recordType === 'formula'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å¥¶é‡ï¼ˆmlï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥å–‚å¥¶é‡" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- è¾…é£Ÿ -->
      <view wx:if="{{recordType === 'solid'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">è¾…é£Ÿç±»å‹</text>
          <picker range="{{solidTypes}}" value="{{recordData.solidTypeIndex}}" bindchange="onSolidTypeChange">
            <view class="picker">{{solidTypes[recordData.solidTypeIndex] || 'è¯·é€‰æ‹©ç±»å‹'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚é£Ÿé‡</text>
          <input type="text" placeholder="è¯·è¾“å…¥å–‚é£Ÿé‡" value="{{recordData.solidAmount}}" bindinput="onSolidAmountChange" />
        </view>
      </view>
      
      <!-- å¤§ä¾¿ -->
      <view wx:if="{{recordType === 'diaper'}}">
        <view class="form-item">
          <text class="form-label">æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ€§çŠ¶</text>
          <picker range="{{diaperTextures}}" value="{{recordData.textureIndex}}" bindchange="onTextureChange">
            <view class="picker">{{diaperTextures[recordData.textureIndex] || 'è¯·é€‰æ‹©æ€§çŠ¶'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">é¢œè‰²</text>
          <picker range="{{diaperColors}}" value="{{recordData.colorIndex}}" bindchange="onColorChange">
            <view class="picker">{{diaperColors[recordData.colorIndex] || 'è¯·é€‰æ‹©é¢œè‰²'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input type="text" placeholder="è¯·è¾“å…¥å¤‡æ³¨" value="{{recordData.note}}" bindinput="onNoteChange" />
        </view>
      </view>
      
      <!-- æˆé•¿ -->
      <view wx:if="{{recordType === 'growth'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">èº«é«˜ï¼ˆcmï¼‰</text>
          <input type="digit" placeholder="è¯·è¾“å…¥èº«é«˜" value="{{recordData.height}}" bindinput="onHeightChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">ä½“é‡ï¼ˆkgï¼‰</text>
          <input type="digit" placeholder="è¯·è¾“å…¥ä½“é‡" value="{{recordData.weight}}" bindinput="onWeightChange" />
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn btn-outline" bindtap="hideModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="saveRecord">ä¿å­˜</button>
    </view>
  </view>
</view>
