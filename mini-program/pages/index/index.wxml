<view class="container">
  <!-- ä»Šæ—¥æ¦‚è§ˆå¡ç‰‡ -->
  <view class="card today-overview">
    <view class="overview-header">
      <text class="text-medium text-bold">ä»Šæ—¥æ¦‚è§ˆ</text>
      <text class="text-small text-muted">{{today}}</text>
    </view>
    
    <!-- å®å®é€‰æ‹©å™¨ -->
    <view class="baby-selector" wx:if="{{babies && babies.length > 0}}">
      <!-- å•ä¸ªå®å®æ—¶æ˜¾ç¤ºå®å®ä¿¡æ¯ -->
      <view class="single-baby-info" wx:if="{{babies.length === 1}}">
        <image class="baby-avatar" src="{{selectedBaby.avatar}}" mode="aspectFill"></image>
        <view class="baby-details">
          <text class="baby-name">{{selectedBaby.name}}</text>
          <text class="baby-age">{{selectedBaby.age}}</text>
        </view>
      </view>
      
      <!-- å¤šä¸ªå®å®æ—¶æ˜¾ç¤ºé€‰æ‹©å™¨ -->
      <view class="multi-baby-selector" wx:else>
        <view class="selector-header">
          <text class="form-label">ğŸ‘¶ æŸ¥çœ‹å®å®æ•°æ®ï¼š</text>
        </view>
        <view class="baby-tabs">
          <view class="baby-tab {{selectedBabyIndex === index ? 'active' : ''}}" 
                wx:for="{{babies}}" 
                wx:key="id" 
                wx:for-index="index"
                bindtap="onBabyChange" 
                data-index="{{index}}">
            <image class="tab-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <view class="tab-content">
              <text class="tab-name">{{item.name}}</text>
              <text class="tab-age">{{item.age}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view class="overview-stats">
      <view class="stat-item">
        <view class="stat-value primary-color">{{todayStats.feedingTotal}}ml</view>
        <view class="stat-label">å–‚å…»æ€»é‡</view>
      </view>
      <view class="stat-item">
        <view class="stat-value secondary-color">{{todayStats.feedingCount}}æ¬¡</view>
        <view class="stat-label">å–‚å…»æ¬¡æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value warning-color">{{todayStats.diaperCount}}æ¬¡</view>
        <view class="stat-label">å¤§ä¾¿æ¬¡æ•°</view>
      </view>
    </view>

    <!-- æ™ºèƒ½å»ºè®® -->
    <view class="suggestion" wx:if="{{suggestion}}">
      <view class="suggestion-icon">ğŸ’¡</view>
      <text class="suggestion-text">{{suggestion}}</text>
    </view>
  </view>

  <!-- å¿«æ·è®°å½•æŒ‰é’® -->
  <view class="card quick-record">
    <view class="quick-record-header">
      <text class="text-medium text-bold">å¿«é€Ÿè®°å½•</text>
    </view>
    
    <view class="record-buttons">
      <view class="record-btn" bindtap="showRecordModal" data-type="breastfeeding">
        <view class="btn-icon">ğŸ¤±</view>
        <text class="btn-text">æ¯ä¹³äº²å–‚</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="bottle">
        <view class="btn-icon">ğŸ¼</view>
        <text class="btn-text">ç“¶å–‚</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="formula">
        <view class="btn-icon">ğŸ¥›</view>
        <text class="btn-text">å¥¶ç²‰</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="solid">
        <view class="btn-icon">ğŸ¥£</view>
        <text class="btn-text">è¾…é£Ÿ</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="water">
        <view class="btn-icon">ğŸ’§</view>
        <text class="btn-text">å–‚æ°´</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="diaper">
        <view class="btn-icon">ğŸ’©</view>
        <text class="btn-text">å¤§ä¾¿</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="growth">
        <view class="btn-icon">ğŸ“</view>
        <text class="btn-text">æˆé•¿</text>
      </view>
      
      <view class="record-btn" bindtap="showRecordModal" data-type="nutrition">
        <view class="btn-icon">ğŸ’Š</view>
        <text class="btn-text">è¥å…»ç´ </text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æœ€è¿‘è®°å½• -->
  <view class="card recent-records">
    <view class="recent-header">
      <text class="text-medium text-bold">ä»Šæ—¥æœ€è¿‘è®°å½•</text>
      <text class="text-small text-primary" bindtap="goToRecords">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="records-list" wx:if="{{recentRecords.length > 0}}">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id">
        <view class="record-icon">
          <text>{{item.icon}}</text>
        </view>
        <view class="record-content">
          <view class="record-title">{{item.title}}</view>
          <view class="record-detail">{{item.detail}}</view>
        </view>
        <view class="record-time">{{item.time}}</view>
      </view>
    </view>
    
    <view class="empty" wx:else>
      <view class="empty-icon">ğŸ“</view>
      <text class="text-muted">è¿˜æ²¡æœ‰è®°å½•ï¼Œå¼€å§‹è®°å½•å®å®çš„æˆé•¿å§</text>
    </view>
  </view>
</view>

<!-- è®°å½•å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="text-medium text-bold">{{modalTitle}}</text>
      <view class="modal-header-actions">
        <view class="voice-btn" bindtap="showVoiceInput">ğŸ¤</view>
        <view class="modal-close" bindtap="hideModal">Ã—</view>
      </view>
    </view>
    
    <!-- è¯­éŸ³è¾“å…¥ç»„ä»¶ -->
    <voice-input 
      show="{{showVoiceInputModal}}"
      record-type="{{recordType}}"
      bind:parsed="onVoiceParsed"
      bind:confirm="onVoiceConfirmed"
      bind:cancel="onVoiceCanceled"
      bind:close="hideVoiceInput">
    </voice-input>
    
    <view class="modal-body">
      <!-- æ¯ä¹³äº²å–‚ -->
      <view wx:if="{{recordType === 'breastfeeding'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥æ—¶é•¿" value="{{recordData.duration}}" bindinput="onDurationChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">é€‰æ‹©ä¹³æˆ¿</text>
          <view class="breast-selector">
            <view class="breast-option {{recordData.breast === 'left' ? 'active' : ''}}" bindtap="selectBreast" data-breast="left">
              å·¦ä¾§
            </view>
            <view class="breast-option {{recordData.breast === 'right' ? 'active' : ''}}" bindtap="selectBreast" data-breast="right">
              å³ä¾§
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç“¶å–‚ -->
      <view wx:if="{{recordType === 'bottle'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å¥¶é‡ï¼ˆmlï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥å–‚å¥¶é‡" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- é…æ–¹å¥¶ -->
      <view wx:if="{{recordType === 'formula'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚å¥¶é‡ï¼ˆmlï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥å–‚å¥¶é‡" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- å–‚æ°´ -->
      <view wx:if="{{recordType === 'water'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚æ°´æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚æ°´é‡ï¼ˆmlï¼‰</text>
          <input type="number" placeholder="è¯·è¾“å…¥å–‚æ°´é‡" value="{{recordData.amount}}" bindinput="onAmountChange" />
        </view>
      </view>
      
      <!-- è¾…é£Ÿ -->
      <view wx:if="{{recordType === 'solid'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">è¾…é£Ÿç±»å‹</text>
          <!-- ä¿®æ”¹ä¸ºç±»ä¼¼ä¹³æˆ¿é€‰æ‹©çš„æŒ‰é’®å½¢å¼ï¼Œæ”¯æŒå¤šé€‰ -->
          <view class="solid-type-selector">
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[0] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{0}}">
              ç±³ç³Š
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[1] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{1}}">
              è”¬èœæ³¥
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[2] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{2}}">
              æ°´æœæ³¥
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[3] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{3}}">
              è‚‰æ³¥
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[4] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{4}}">
              è›‹é»„
            </view>
            <view class="solid-type-option {{recordData.solidTypeSelections && recordData.solidTypeSelections[5] ? 'active' : ''}}" bindtap="toggleSolidType" data-index="{{5}}">
              å…¶ä»–
            </view>
          </view>
        </view>
        
        <!-- æ–°å¢ï¼šå¤šç§é£Ÿæè¾“å…¥ -->
        <view class="form-item">
          <text class="form-label">é£Ÿæï¼ˆå¤šç§ï¼Œç”¨é€—å·åˆ†éš”ï¼‰</text>
          <input type="text" placeholder="ä¾‹å¦‚ï¼šç±³ç²‰,èƒ¡èåœæ³¥,è‹¹æœæ³¥" value="{{recordData.solidIngredients}}" bindinput="onSolidIngredientsChange" />
        </view>
        
        <!-- æ–°å¢ï¼šå“ç‰Œè¾“å…¥ -->
        <view class="form-item">
          <text class="form-label">å“ç‰Œï¼ˆå¯é€‰ï¼‰</text>
          <input type="text" placeholder="è¯·è¾“å…¥å“ç‰Œ" value="{{recordData.solidBrand}}" bindinput="onSolidBrandChange" />
        </view>
        
        <!-- æ–°å¢ï¼šäº§åœ°è¾“å…¥ -->
        <view class="form-item">
          <text class="form-label">äº§åœ°ï¼ˆå¯é€‰ï¼‰</text>
          <input type="text" placeholder="è¯·è¾“å…¥äº§åœ°" value="{{recordData.solidOrigin}}" bindinput="onSolidOriginChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚é£Ÿé‡(ç±³ç²‰å‡ å‹º)</text>
          <input type="number" placeholder="è¯·è¾“å…¥å–‚é£Ÿé‡" value="{{recordData.solidAmount}}" bindinput="onSolidAmountChange" />
        </view>
      </view>
      
      <!-- å¤§ä¾¿ -->
      <view wx:if="{{recordType === 'diaper'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ€§çŠ¶</text>
          <picker range="{{diaperTextures}}" value="{{recordData.textureIndex}}" bindchange="onTextureChange">
            <view class="picker">{{diaperTextures[recordData.textureIndex] || 'è¯·é€‰æ‹©æ€§çŠ¶'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">é¢œè‰²</text>
          <picker range="{{diaperColors}}" value="{{recordData.colorIndex}}" bindchange="onColorChange">
            <view class="picker">{{diaperColors[recordData.colorIndex] || 'è¯·é€‰æ‹©é¢œè‰²'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input type="text" placeholder="è¯·è¾“å…¥å¤‡æ³¨" value="{{recordData.note}}" bindinput="onNoteChange" />
        </view>
      </view>
      
      <!-- æˆé•¿ -->
      <view wx:if="{{recordType === 'growth'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">èº«é«˜ï¼ˆcmï¼‰</text>
          <input type="digit" placeholder="è¯·è¾“å…¥èº«é«˜" value="{{recordData.height}}" bindinput="onHeightChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">ä½“é‡ï¼ˆkgï¼‰</text>
          <input type="digit" placeholder="è¯·è¾“å…¥ä½“é‡" value="{{recordData.weight}}" bindinput="onWeightChange" />
        </view>
      </view>
      
      <!-- è¥å…»ç´  -->
      <view wx:if="{{recordType === 'nutrition'}}">
        <!-- æ˜¨å¤©è¥å…»ç´ è®°å½• -->
        <view class="yesterday-nutrition-section" wx:if="{{yesterdayNutritionRecords && yesterdayNutritionRecords.length > 0}}">
          <text class="yesterday-label">æ˜¨å¤©è¥å…»ç´ æ‘„å…¥æƒ…å†µ</text>
          <view class="yesterday-nutrition-list">
            <view class="yesterday-nutrition-item" wx:for="{{yesterdayNutritionRecords}}" wx:key="id">
              <view class="nutrition-detail-item">
                <text class="nutrition-icon-small">ğŸ’Š</text>
                <view class="nutrition-types-wrapper">
                  <text class="nutrition-type-tag" wx:for="{{item.types}}" wx:for-item="type" wx:key="*this">
                    {{type}}
                  </text>
                </view>
                <text class="nutrition-detail-time">{{item.time}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{recordData.date}}" bindchange="onDateChange">
            <view class="picker">{{recordData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¶é—´</text>
          <picker mode="time" value="{{recordData.startTime}}" bindchange="onTimeChange">
            <view class="picker">{{recordData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">è¥å…»ç´ ç±»å‹</text>
          <!-- ä½¿ç”¨ç±»ä¼¼è¾…é£Ÿçš„å¤šé€‰æŒ‰é’® -->
          <view class="nutrition-type-selector">
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[0] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{0}}">
              AD
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[1] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{1}}">
              D3
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[2] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{2}}">
              é’™
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[3] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{3}}">
              DHA
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[4] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{4}}">
              é”Œ
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[5] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{5}}">
              é“
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[6] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{6}}">
              ç›Šç”ŸèŒ
            </view>
            <view class="nutrition-type-option {{recordData.nutritionSelections && recordData.nutritionSelections[7] ? 'active' : ''}}" bindtap="toggleNutritionType" data-index="{{7}}">
              å…¶ä»–
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn btn-outline" bindtap="hideModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="saveRecord">ä¿å­˜</button>
    </view>
  </view>
</view>
