<view class="container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <!-- å®å®é€‰æ‹©å™¨ -->
    <view class="baby-selector" wx:if="{{babies && babies.length > 0}}">
      <!-- å•ä¸ªå®å®æ—¶æ˜¾ç¤ºå®å®ä¿¡æ¯ -->
      <view class="single-baby-info" wx:if="{{babies.length === 1}}">
        <image class="baby-avatar-small" src="{{selectedBaby.avatar}}" mode="aspectFill"></image>
        <view class="baby-details">
          <text class="baby-name-small">{{selectedBaby.name}}</text>
          <text class="baby-age-small">{{selectedBaby.age}}</text>
        </view>
      </view>
      
      <!-- å¤šä¸ªå®å®æ—¶æ˜¾ç¤ºé€‰æ‹©å™¨ -->
      <view class="multi-baby-selector" wx:else>
        <view class="selector-header">
          <text class="form-label">ğŸ‘¶ å®å®è®°å½•ï¼š</text>
        </view>
        <view class="baby-mini-tabs">
          <view class="baby-mini-tab {{selectedBabyIndex === index ? 'active' : ''}}" 
                wx:for="{{babies}}" 
                wx:key="id" 
                wx:for-index="index"
                bindtap="onBabyChange" 
                data-index="{{index}}">
            <image class="mini-tab-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <text class="mini-tab-name">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">
        å…¨éƒ¨
      </view>
      <view class="filter-tab {{currentFilter === 'feeding' ? 'active' : ''}}" bindtap="setFilter" data-filter="feeding">
        å–‚å…»
      </view>
      <view class="filter-tab {{currentFilter === 'diaper' ? 'active' : ''}}" bindtap="setFilter" data-filter="diaper">
        å¤§ä¾¿
      </view>
      <view class="filter-tab {{currentFilter === 'growth' ? 'active' : ''}}" bindtap="setFilter" data-filter="growth">
        æˆé•¿
      </view>
    </view>
    
    <view class="date-picker">
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="date-display">
          <text>{{selectedDate}}</text>
          <text class="date-icon">ğŸ“…</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ—¶é—´è½´è§†å›¾ -->
  <view class="timeline-container">
    <view class="timeline" wx:if="{{filteredRecords.length > 0}}">
      <view class="timeline-item" wx:for="{{filteredRecords}}" wx:key="id">
        <view class="timeline-dot {{item.type}}"></view>
        <view class="timeline-line" wx:if="{{index < filteredRecords.length - 1}}"></view>
        
        <view class="timeline-content">
          <view class="record-card">
            <view class="record-header">
              <view class="record-type">
                <text class="record-icon">{{item.icon}}</text>
                <text class="record-title">{{item.title}}</text>
              </view>
              <view class="record-time">{{item.time}}</view>
            </view>
            
            <view class="record-body">
              <view class="record-details">
                <view class="detail-item" wx:for="{{item.details}}" wx:key="*this" wx:for-item="detail">
                  <text class="detail-label">{{detail.label}}:</text>
                  <text class="detail-value">{{detail.value}}</text>
                </view>
              </view>
              
              <view class="record-actions">
                <view class="action-btn" bindtap="editRecord" data-id="{{item.id}}">
                  <text class="action-icon">âœï¸</text>
                  <text class="action-text">ç¼–è¾‘</text>
                </view>
                <view class="action-btn delete" bindtap="deleteRecord" data-id="{{item.id}}">
                  <text class="action-icon">ğŸ—‘ï¸</text>
                  <text class="action-text">åˆ é™¤</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“</view>
      <text class="empty-text">æš‚æ— è®°å½•</text>
      <text class="empty-subtext">å¼€å§‹è®°å½•å®å®çš„æˆé•¿å§</text>
    </view>
  </view>
</view>

<!-- ç¼–è¾‘è®°å½•å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showEditModal}}" bindtap="hideEditModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="text-medium text-bold">ç¼–è¾‘è®°å½•</text>
      <view class="modal-close" bindtap="hideEditModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <!-- æ ¹æ®è®°å½•ç±»å‹æ˜¾ç¤ºä¸åŒçš„ç¼–è¾‘è¡¨å• -->
      <view wx:if="{{editingRecord.type === 'BREASTFEEDING'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
          <input type="number" value="{{editingRecord.duration}}" bindinput="onEditDurationChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">é€‰æ‹©ä¹³æˆ¿</text>
          <view class="breast-selector">
            <view class="breast-option {{editingRecord.breast === 'left' ? 'active' : ''}}" bindtap="selectEditBreast" data-breast="left">
              å·¦ä¾§
            </view>
            <view class="breast-option {{editingRecord.breast === 'right' ? 'active' : ''}}" bindtap="selectEditBreast" data-breast="right">
              å³ä¾§
            </view>
          </view>
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'BOTTLE' || editingRecord.type === 'FORMULA' || editingRecord.type === 'WATER'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label" wx:if="{{editingRecord.type === 'WATER'}}">å–‚æ°´é‡ï¼ˆmlï¼‰</text>
          <text class="form-label" wx:else>å–‚å¥¶é‡ï¼ˆmlï¼‰</text>
          <input type="number" value="{{editingRecord.amount}}" bindinput="onEditAmountChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'SOLID'}}">
        <view class="form-item">
          <text class="form-label">å–‚å…»æ—¶é—´</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">è¾…é£Ÿç±»å‹</text>
          <!-- ä¿®æ”¹ä¸ºç±»ä¼¼ä¹³æˆ¿é€‰æ‹©çš„æŒ‰é’®å½¢å¼ï¼Œæ”¯æŒå¤šé€‰ -->
          <view class="solid-type-selector">
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[0] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{0}}">
              ç±³ç³Š
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[1] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{1}}">
              è”¬èœæ³¥
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[2] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{2}}">
              æ°´æœæ³¥
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[3] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{3}}">
              è‚‰æ³¥
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[4] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{4}}">
              è›‹é»„
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[5] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{5}}">
              å…¶ä»–
            </view>
          </view>
        </view>
        
        <!-- æ–°å¢ï¼šå¤šç§é£Ÿæè¾“å…¥ -->
        <view class="form-item">
          <text class="form-label">é£Ÿæï¼ˆå¤šç§ï¼Œç”¨é€—å·åˆ†éš”ï¼‰</text>
          <input type="text" value="{{editingRecord.solidIngredients}}" bindinput="onEditSolidIngredientsChange" />
        </view>
        
        <!-- æ–°å¢ï¼šå“ç‰Œè¾“å…¥ -->
        <view class="form-item">
          <text class="form-label">å“ç‰Œï¼ˆå¯é€‰ï¼‰</text>
          <input type="text" value="{{editingRecord.solidBrand}}" bindinput="onEditSolidBrandChange" />
        </view>
        
        <!-- æ–°å¢ï¼šäº§åœ°è¾“å…¥ -->
        <view class="form-item">
          <text class="form-label">äº§åœ°ï¼ˆå¯é€‰ï¼‰</text>
          <input type="text" value="{{editingRecord.solidOrigin}}" bindinput="onEditSolidOriginChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">å–‚é£Ÿé‡(ç±³ç²‰å‡ å‹º)</text>
          <input type="number" value="{{editingRecord.solidAmount}}" bindinput="onEditSolidAmountChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'DIAPER'}}">
        <view class="form-item">
          <text class="form-label">æ—¶é—´</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ€§çŠ¶</text>
          <picker range="{{diaperTextures}}" value="{{editingRecord.textureIndex}}" bindchange="onEditTextureChange">
            <view class="picker">{{diaperTextures[editingRecord.textureIndex]}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">é¢œè‰²</text>
          <picker range="{{diaperColors}}" value="{{editingRecord.colorIndex}}" bindchange="onEditColorChange">
            <view class="picker">{{diaperColors[editingRecord.colorIndex]}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input type="text" value="{{editingRecord.note}}" bindinput="onEditNoteChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'GROWTH'}}">
        <view class="form-item">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{editingRecord.date}}" bindchange="onEditDateChange">
            <view class="picker">{{editingRecord.date}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">èº«é«˜ï¼ˆcmï¼‰</text>
          <input type="digit" value="{{editingRecord.height}}" bindinput="onEditHeightChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">ä½“é‡ï¼ˆkgï¼‰</text>
          <input type="digit" value="{{editingRecord.weight}}" bindinput="onEditWeightChange" />
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn btn-outline" bindtap="hideEditModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="saveEdit">ä¿å­˜</button>
    </view>
  </view>
</view>
