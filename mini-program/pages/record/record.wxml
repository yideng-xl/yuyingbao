<view class="container">
  <!-- 筛选栏 -->
  <view class="filter-bar">
    <!-- 宝宝选择器 -->
    <view class="baby-selector" wx:if="{{babies && babies.length > 0}}">
      <!-- 单个宝宝时显示宝宝信息 -->
      <view class="single-baby-info" wx:if="{{babies.length === 1}}">
        <image class="baby-avatar-small" src="{{selectedBaby.avatar}}" mode="aspectFill"></image>
        <view class="baby-details">
          <text class="baby-name-small">{{selectedBaby.name}}</text>
          <text class="baby-age-small">{{selectedBaby.age}}</text>
        </view>
      </view>
      
      <!-- 多个宝宝时显示选择器 -->
      <view class="multi-baby-selector" wx:else>
        <view class="selector-header">
          <text class="form-label">👶 宝宝记录：</text>
        </view>
        <view class="baby-mini-tabs">
          <view class="baby-mini-tab {{selectedBabyIndex === index ? 'active' : ''}}" 
                wx:for="{{babies}}" 
                wx:key="id" 
                wx:for-index="index"
                bindtap="onBabyChange" 
                data-index="{{index}}">
            <image class="mini-tab-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <text class="mini-tab-name">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="setFilter" data-filter="all">
        全部
      </view>
      <view class="filter-tab {{currentFilter === 'feeding' ? 'active' : ''}}" bindtap="setFilter" data-filter="feeding">
        喂养
      </view>
      <view class="filter-tab {{currentFilter === 'diaper' ? 'active' : ''}}" bindtap="setFilter" data-filter="diaper">
        大便
      </view>
      <view class="filter-tab {{currentFilter === 'growth' ? 'active' : ''}}" bindtap="setFilter" data-filter="growth">
        成长
      </view>
    </view>
    
    <view class="date-picker">
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="date-display">
          <text>{{selectedDate}}</text>
          <text class="date-icon">📅</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 时间轴视图 -->
  <view class="timeline-container">
    <view class="timeline" wx:if="{{filteredRecords.length > 0}}">
      <view class="timeline-item" wx:for="{{filteredRecords}}" wx:key="id">
        <view class="timeline-dot {{item.type}}"></view>
        <view class="timeline-line" wx:if="{{index < filteredRecords.length - 1}}"></view>
        
        <view class="timeline-content">
          <view class="record-card">
            <view class="record-header">
              <view class="record-type">
                <text class="record-icon">{{item.icon}}</text>
                <text class="record-title">{{item.title}}</text>
              </view>
              <view class="record-time">{{item.time}}</view>
            </view>
            
            <view class="record-body">
              <view class="record-details">
                <view class="detail-item" wx:for="{{item.details}}" wx:key="*this" wx:for-item="detail">
                  <text class="detail-label" wx:if="{{detail.label}}">{{detail.label}}:</text>
                  <text class="detail-value">{{detail.value}}</text>
                </view>
              </view>
              
              <view class="record-actions">
                <view class="action-btn" bindtap="editRecord" data-id="{{item.id}}">
                  <text class="action-icon">✏️</text>
                  <text class="action-text">编辑</text>
                </view>
                <view class="action-btn delete" bindtap="deleteRecord" data-id="{{item.id}}">
                  <text class="action-icon">🗑️</text>
                  <text class="action-text">删除</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">📝</view>
      <text class="empty-text">暂无记录</text>
      <text class="empty-subtext">开始记录宝宝的成长吧</text>
    </view>
  </view>
</view>

<!-- 编辑记录弹窗 -->
<view class="modal-overlay" wx:if="{{showEditModal}}" bindtap="hideEditModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="text-medium text-bold">编辑记录</text>
      <view class="modal-close" bindtap="hideEditModal">×</view>
    </view>
    
    <view class="modal-body">
      <!-- 根据记录类型显示不同的编辑表单 -->
      <view wx:if="{{editingRecord.type === 'BREASTFEEDING'}}">
        <view class="form-item">
          <text class="form-label">喂养时间</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">时长（分钟）</text>
          <input type="number" value="{{editingRecord.duration}}" bindinput="onEditDurationChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">选择乳房</text>
          <view class="breast-selector">
            <view class="breast-option {{editingRecord.breast === 'left' ? 'active' : ''}}" bindtap="selectEditBreast" data-breast="left">
              左侧
            </view>
            <view class="breast-option {{editingRecord.breast === 'right' ? 'active' : ''}}" bindtap="selectEditBreast" data-breast="right">
              右侧
            </view>
          </view>
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'BOTTLE' || editingRecord.type === 'FORMULA' || editingRecord.type === 'WATER'}}">
        <view class="form-item">
          <text class="form-label">喂养时间</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label" wx:if="{{editingRecord.type === 'WATER'}}">喂水量（ml）</text>
          <text class="form-label" wx:else>喂奶量（ml）</text>
          <input type="number" value="{{editingRecord.amount}}" bindinput="onEditAmountChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'SOLID'}}">
        <view class="form-item">
          <text class="form-label">喂养时间</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">辅食类型</text>
          <!-- 修改为类似乳房选择的按钮形式，支持多选 -->
          <view class="solid-type-selector">
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[0] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{0}}">
              米糊
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[1] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{1}}">
              蔬菜泥
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[2] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{2}}">
              水果泥
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[3] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{3}}">
              肉泥
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[4] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{4}}">
              蛋黄
            </view>
            <view class="solid-type-option {{editingRecord.solidTypeSelections && editingRecord.solidTypeSelections[5] ? 'active' : ''}}" bindtap="toggleEditSolidType" data-index="{{5}}">
              其他
            </view>
          </view>
        </view>
        
        <!-- 新增：多种食材输入 -->
        <view class="form-item">
          <text class="form-label">食材（多种，用逗号分隔）</text>
          <input type="text" value="{{editingRecord.solidIngredients}}" bindinput="onEditSolidIngredientsChange" />
        </view>
        
        <!-- 新增：品牌输入 -->
        <view class="form-item">
          <text class="form-label">品牌（可选）</text>
          <input type="text" value="{{editingRecord.solidBrand}}" bindinput="onEditSolidBrandChange" />
        </view>
        
        <!-- 新增：产地输入 -->
        <view class="form-item">
          <text class="form-label">产地（可选）</text>
          <input type="text" value="{{editingRecord.solidOrigin}}" bindinput="onEditSolidOriginChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">喂食量(米粉几勺)</text>
          <input type="number" value="{{editingRecord.solidAmount}}" bindinput="onEditSolidAmountChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'DIAPER'}}">
        <view class="form-item">
          <text class="form-label">时间</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">性状</text>
          <picker range="{{diaperTextures}}" value="{{editingRecord.textureIndex}}" bindchange="onEditTextureChange">
            <view class="picker">{{diaperTextures[editingRecord.textureIndex]}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">颜色</text>
          <picker range="{{diaperColors}}" value="{{editingRecord.colorIndex}}" bindchange="onEditColorChange">
            <view class="picker">{{diaperColors[editingRecord.colorIndex]}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">备注</text>
          <input type="text" value="{{editingRecord.note}}" bindinput="onEditNoteChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'GROWTH'}}">
        <view class="form-item">
          <text class="form-label">日期</text>
          <picker mode="date" value="{{editingRecord.date}}" bindchange="onEditDateChange">
            <view class="picker">{{editingRecord.date}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">身高（cm）</text>
          <input type="digit" value="{{editingRecord.height}}" bindinput="onEditHeightChange" />
        </view>
        
        <view class="form-item">
          <text class="form-label">体重（kg）</text>
          <input type="digit" value="{{editingRecord.weight}}" bindinput="onEditWeightChange" />
        </view>
      </view>
      
      <view wx:if="{{editingRecord.type === 'NUTRITION'}}">
        <view class="form-item">
          <text class="form-label">时间</text>
          <picker mode="time" value="{{editingRecord.startTime}}" bindchange="onEditTimeChange">
            <view class="picker">{{editingRecord.startTime}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">营养素类型</text>
          <view class="nutrition-type-selector">
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[0] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{0}}">
              AD
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[1] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{1}}">
              D3
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[2] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{2}}">
              钙
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[3] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{3}}">
              DHA
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[4] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{4}}">
              锌
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[5] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{5}}">
              铁
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[6] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{6}}">
              益生菌
            </view>
            <view class="nutrition-type-option {{editingRecord.nutritionSelections && editingRecord.nutritionSelections[7] ? 'active' : ''}}" bindtap="toggleEditNutritionType" data-index="{{7}}">
              其他
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn btn-outline" bindtap="hideEditModal">取消</button>
      <button class="btn btn-primary" bindtap="saveEdit">保存</button>
    </view>
  </view>
</view>
